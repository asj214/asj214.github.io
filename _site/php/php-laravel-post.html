<!doctype html>
<html>

<head>

  <title>
    
      라라벨(laravel) 7.x 시작하기 (3) | 주피라이터
    
  </title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="주피라이터" />
  <!-- Use RSS-2.0 -->
  <!--<link href="https://asj214.github.io/rss-feed.xml" type="application/rss+xml" rel="alternate" title="주피라이터 | 기록되지 않는 것은 기억되지 않는다."/>
  //-->

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quattrocento+Sans">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      });
  </script>

  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-168354300-1', 'auto');
  ga('send', 'pageview');
</script>


  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>라라벨(laravel) 7.x 시작하기 (3) | 주피라이터</title>
<meta name="generator" content="Jekyll v3.6.2" />
<meta property="og:title" content="라라벨(laravel) 7.x 시작하기 (3)" />
<meta name="author" content="sjahn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="이전글에서는 composer로 라라벨을 설치하고, laravel/ui 라는 패키지를 설치하여 회원가입, 로그인 기능 구현을 하였다. 이번에는 회원 테이블에 최종 로그인 날짜를 기록하는 기능을 추가하고, 간단한 게시판을 만들어볼 예정이다. 기존에 라라벨, 장고, 루비온더레일즈같은 프레임워크를 사용해본 경험이 없는 사람들에게는 많이 생소한 개발방식이라 이 방식을 익히는 것이 굉장히 중요하다. 가장 핵심이 되는 것은 artisan을 이용한 db 마이그레이션, 모델 컨트롤러 생성이다." />
<meta property="og:description" content="이전글에서는 composer로 라라벨을 설치하고, laravel/ui 라는 패키지를 설치하여 회원가입, 로그인 기능 구현을 하였다. 이번에는 회원 테이블에 최종 로그인 날짜를 기록하는 기능을 추가하고, 간단한 게시판을 만들어볼 예정이다. 기존에 라라벨, 장고, 루비온더레일즈같은 프레임워크를 사용해본 경험이 없는 사람들에게는 많이 생소한 개발방식이라 이 방식을 익히는 것이 굉장히 중요하다. 가장 핵심이 되는 것은 artisan을 이용한 db 마이그레이션, 모델 컨트롤러 생성이다." />
<link rel="canonical" href="http://localhost:4000/php/php-laravel-post.html" />
<meta property="og:url" content="http://localhost:4000/php/php-laravel-post.html" />
<meta property="og:site_name" content="주피라이터" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-29T00:00:00+09:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"sjahn"},"url":"http://localhost:4000/php/php-laravel-post.html","headline":"라라벨(laravel) 7.x 시작하기 (3)","dateModified":"2020-01-29T00:00:00+09:00","datePublished":"2020-01-29T00:00:00+09:00","description":"이전글에서는 composer로 라라벨을 설치하고, laravel/ui 라는 패키지를 설치하여 회원가입, 로그인 기능 구현을 하였다. 이번에는 회원 테이블에 최종 로그인 날짜를 기록하는 기능을 추가하고, 간단한 게시판을 만들어볼 예정이다. 기존에 라라벨, 장고, 루비온더레일즈같은 프레임워크를 사용해본 경험이 없는 사람들에게는 많이 생소한 개발방식이라 이 방식을 익히는 것이 굉장히 중요하다. 가장 핵심이 되는 것은 artisan을 이용한 db 마이그레이션, 모델 컨트롤러 생성이다.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/php/php-laravel-post.html"},"@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <script data-ad-client="ca-pub-1094854820920281" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>


<body>

  <div class="container">
    <header class="masthead">
  <h3 class="masthead-title">
    <a href="/">주피라이터</a>
    <!-- <small class="masthead-subtitle">기록되지 않는 것은 기억되지 않는다.</small> -->
    <div class="menu">
  <nav class="menu-content">
    
      <a href="/menu/about.html">About</a>
    
      <a href="/menu/writing.html">Writing</a>
    
  </nav>
  <nav class="social-icons">
    
  
  
    <a href="https://asj214.github.io" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  </nav>
</div>

  </h3>
</header>


    <div class="post-container">
      <h1>
  라라벨(laravel) 7.x 시작하기 (3)
</h1>



<p><br />
<a href="/php/php-laravel-install.html">이전글</a>에서는 <code class="highlighter-rouge">composer</code>로 라라벨을 설치하고, 
laravel/ui 라는 패키지를 설치하여 회원가입, 로그인 기능 구현을 하였다.<br />
<br />
이번에는 회원 테이블에 최종 로그인 날짜를 기록하는 기능을 추가하고, 간단한 게시판을 만들어볼 예정이다.<br />
<br />
기존에 라라벨, 장고, 루비온더레일즈같은 프레임워크를 사용해본 경험이 없는 사람들에게는 많이 생소한 개발방식이라 이 방식을 익히는 것이 굉장히 중요하다.<br />
<br />
가장 핵심이 되는 것은 <code class="highlighter-rouge">artisan</code>을 이용한 db 마이그레이션, 모델 컨트롤러 생성이다.<br />
<br /></p>

<h4 id="최종-로그인-컬럼-추가하기">최종 로그인 컬럼 추가하기</h4>
<ol>
  <li>마이그레이션 파일 생성<br />
 <code class="highlighter-rouge">artisan make:migration add_columns_in_users --table=users</code></li>
  <li><code class="highlighter-rouge">database/migrations</code>에 새로 생성된 마이그레이션 파일에 컬럼 추가 코드 작성
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">(){</span>

     <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">){</span>
         <span class="c1">// 최근 접속 일
</span>         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">datetime</span><span class="p">(</span><span class="s1">'last_login_at'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">after</span><span class="p">(</span><span class="s1">'remember_token'</span><span class="p">);</span>
     <span class="p">});</span>

 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>마이그레이션 실행<br />
 <code class="highlighter-rouge">artisan migrate</code></li>
  <li><code class="highlighter-rouge">app/Http/Controllers/Auth/LoginController.php</code> 에 메소드 추가
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="nf">authenticated</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$user</span><span class="p">){</span>
     <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">'last_login_at'</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">)]);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><code class="highlighter-rouge">app/User.php</code> 에 <code class="highlighter-rouge">$fillable</code>에 <code class="highlighter-rouge">last_login_at</code> 추가
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
     <span class="s1">'name'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">,</span> <span class="s1">'last_login_at'</span>
 <span class="p">];</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>이제 로그인을 할때 마다 <code class="highlighter-rouge">users.last_login_at</code> 에 날짜가 갱신된다.
<br />
<br /></p>

<h4 id="게시판-만들기">게시판 만들기</h4>

<ol>
  <li>
    <p>마이그레이션 파일 생성
 <code class="highlighter-rouge">artisan make:migration create_posts_table --create=posts</code></p>
  </li>
  <li>마이그레이션 파일 작성
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">(){</span>
     <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">){</span>
         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bigIncrements</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>
         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">);</span> <span class="c1">// 작성자 아이디
</span>         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span> <span class="c1">// 제목
</span>         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">'body'</span><span class="p">);</span> <span class="c1">// 본문
</span>         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span> <span class="c1">// 생성일, 수정일
</span>         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">softDeletes</span><span class="p">();</span> <span class="c1">// 삭제일
</span>         <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">'deleted_at'</span><span class="p">);</span>
     <span class="p">});</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>마이그레이션
 <code class="highlighter-rouge">artisan migrate</code></p>
  </li>
  <li>
    <p>모델 생성
 <code class="highlighter-rouge">artisan make:model Post</code></p>
  </li>
  <li>컨트롤러 생성
 <code class="highlighter-rouge">artisan make:controller PostController --resource</code>
    <blockquote>
      <p>–resource 를 추가시키면 컨트롤러에 기본적인 CRUD 메소드들을 알아서 생성해준다.</p>
    </blockquote>
  </li>
  <li><code class="highlighter-rouge">routes/web.php</code>에 라우트 추가
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">Route</span><span class="o">::</span><span class="na">resource</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="s1">'PostController'</span><span class="p">);</span>
</code></pre></div>    </div>
    <p>이렇게 간단하게 추가가 가능하지만… 실제 업무에서 쓸때는 개별로 추가하는 방식을 사용하는 사례가 많다.</p>
  </li>
  <li>
    <p>라우트 확인
 <code class="highlighter-rouge">artisan route:list --name=posts</code></p>
  </li>
  <li><code class="highlighter-rouge">resources/views/layouts/app.blade.php</code> gnb에 post 링크 추가
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"navbar-nav mr-auto"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item dropdown"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"navbarDropdown"</span> <span class="na">class=</span><span class="s">"nav-link dropdown-toggle"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">role=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">aria-haspopup=</span><span class="s">"true"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span> <span class="na">v-pre</span><span class="nt">&gt;</span>
             {{ __('Post') }} <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"caret"</span><span class="nt">&gt;&lt;/span&gt;</span>
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-menu dropdown-menu-right"</span> <span class="na">aria-labelledby=</span><span class="s">"navbarDropdown"</span><span class="nt">&gt;</span>
             <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"{{ route('posts.index') }}"</span><span class="nt">&gt;</span>{{ __('List') }}<span class="nt">&lt;/a&gt;</span>
             @if(Auth::guard()-&gt;check())
             <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"{{ route('posts.create') }}"</span><span class="nt">&gt;</span>{{ __('Write') }}<span class="nt">&lt;/a&gt;</span>
             @endif
         <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;/li&gt;</span>
 <span class="nt">&lt;/ul&gt;</span>
</code></pre></div>    </div>
    <p>중간에 <code class="highlighter-rouge">@if(Auth::guard()-&gt;check())</code>라는 조건을 걸어 로그인한 사용자한테만 글쓰기 버튼은 노출되는 것으로 처리</p>
  </li>
  <li><code class="highlighter-rouge">app/Http/Controllers/PostController.php</code> 에 사용자 인증 조건 추가
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
     <span class="c1">// 사용자 권한
</span>     <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">'auth'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'except'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'index'</span><span class="p">,</span> <span class="s1">'show'</span><span class="p">]]);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
    <blockquote>
      <p>위 처럼 컨트롤러 생성자에 미들웨어로 추가해두면 로그인하지 않은 유저는 index, show 말고는 진입이 불가능하다.</p>
    </blockquote>
  </li>
</ol>

<p>이후부터의 작업은 너무 방대해서 일일히 작성하기가 힘들어서 작성한 <a href="https://github.com/asj214/sjahn.homestead.test/blob/master/app/Http/Controllers/PostController.php">코드</a>를 확인 사실 컨트롤러 보면 뭐 더 없다.<br />
<br />
그나마 신경써야할 부분인 softdeletes 인데 이는 DB에서 삭제 시 실제로 삭제하는 것이 아닌, deleted_at 컬럼에 삭제 당시 날짜를 기록하여
실제로는 삭제하지 않았는데 삭제 처리되었다는 식으로 처리하는 가능이다.<br />
이 기능을 구현하려면 마이그레이션 작성 시 <code class="highlighter-rouge">$table-&gt;softDeletes();</code> 라는 것을 추가해준 후 모델 파일에 몇 가지 코드를 추가해주기만 하면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\SoftDeletes</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
    <span class="c1">//
</span>    <span class="k">use</span> <span class="nx">SoftDeletes</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s2">"posts"</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'deleted_at'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>


<span class="post-date">
  Written on
  
  January
  29th,
  2020
  by
  
    sjahn
  
</span>

<div class="post-date">Feel free to share!</div>
  <div class="sharing-icons">
    <a href="https://twitter.com/intent/tweet?text=라라벨(laravel) 7.x 시작하기 (3)&amp;url=https://asj214.github.io/php/php-laravel-post.html" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=https://asj214.github.io/php/php-laravel-post.html&amp;title=라라벨(laravel) 7.x 시작하기 (3)" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
  </div>
</div>


<div class="related">
  <h1 >You may also enjoy:</h1>
  
  <ul class="related-posts">
    
      
        
        
      
        
          <li>
            <h3>
              <a href="/php/php-laravel-install.html">
                라라벨(laravel) 7.x 시작하기 (2)
                <small>January 26, 2020</small>
              </a>
            </h3>
          </li>
          
        
      
        
          <li>
            <h3>
              <a href="/php/php-laravel-started.html">
                라라벨(laravel) 7.x 시작하기 (1)
                <small>January 23, 2020</small>
              </a>
            </h3>
          </li>
          
        
      
    
      
        
        
      
        
        
      
        
        
      
    
  </ul>
</div>



  <section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = "sjahn";
    var disqus_identifier = "/php/php-laravel-post.html";
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



    </div>

    <footer class="footer">
  
  
  
    <a href="https://asj214.github.io" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  <div class="post-date"><a href="/menu/about.html">주피라이터 | 기록되지 않는 것은 기억되지 않는다. by sjahn</a></div>
</footer>
  </div>
</body>
</html>
